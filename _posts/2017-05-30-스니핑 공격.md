---
layout: post
title: 스니핑 공격
categories: [study, hacking]
fullview: true
comments: true
---

스니핑 공격은 수동적 공격이라고도 말하는데, 그 이유는 공격할 때 아무 것도 하지 않고 조용히 있는 것만으로도 충분하기 때문이다.

## 스니핑의 원리
기본적으로 네트워크에 접속하는 모든 시스템은 설정된 IP 주소값과 동일한 MAC 주소값을 가지고 있다. 통신할 때 네트워크 카드는 이 두 가지 정보(2계층의 MAC 주소와 3계층의 IP 주소)를 가지고 자신의 랜 카드에 들어오는 프로토콜 형식에 따른 전기적 신호의 헤더 부분, 즉 주소 값을 인식하고 자신의 버퍼에 저장할지를 결정한다. 다시 말해 네트워크 카드에 인식된 2계층과 3계층 정보가 자신의 것과 일치하지 않는 패킷은 무시한다.

그러나 스니핑을 수행하는 공격자는 자신이 가지지 말아야 할 정보까지 모두 볼 수 있어야 하기 때문에 2계층과 3계층 정보를 이용한 필터링은 방해물일 뿐이다. 이때 2계층과 3계층에서의 필터링을 해제하는 랜 카드의 모드를 프러미스큐어스(Promiscuous) 모드라고 한다. 프러미스큐어스 모드는 간단한 설정 사항이나 스니핑을 위한 드라이버 설치를 통해 바꿀 수 있다.

## 스위치 재밍 공격
OSI 7계층을 설명할 때 스위치에 포트와 MAC 주소를 저장한 테이블이 있다고 한 것을 기억할 것이다. 스위치 재밍(Switch Jamming)은 스위치가 MAC 주소 테이블을 기반으로 패킷을 포트에 스위칭할 때 정상적인 스위칭 기능을 마비시키는 공격을 말한다.

스위치에 랜덤한 형태로 생성한 MAC 주소를 가진 패킷을 무한대로 보내면 스위치의 MAC 테이블은 자연스레 저장 용량을 넘고, 스위치는 원래 기능을 잃고 더비 허브처럼 작동하게 된다. 그리고 스위치가 더비 허브와 똑같이 작동하면 공격자는 ARP 스푸핑이나 ICMP 리다이렉트처럼 패킷이 굳이 자기에게 오게 할 필요가 없어 스니핑 공격 자체가 쉬워진다. 하지만 모든 스위치가 그런 것은 아니며, 고가의 스위치는 MAC 테이블의 캐시와 연산자가 쓰는 캐시가 독립적으로 나뉘어져 있어 스위치 재밍 공격이 통하지 않는 경우도 있다.

## SPAN 포트 태핑 공격
SPAN(Switch Port Analyzer)은 스위치의 포트 미러링(Port Mirroring) 기능을 이용한 것이다. 포트 미러링이란 각 포트에 전송되는 데이터를 미러링하고 있는 포트에도 똑같이 보내주는 것으로, 침입 탑지 시스템이나 네트워크 모니터링 또는 로그 시스템을 설치 할 때 많이 사용한다.

SPAN 포트는 기본적으로 네트워크 장비에서 간단한 설정으로 활성화되지만, 포트 태핑(Tapping)은 하드웨어적인 장비를 이용한다. SPAN 포트와 태핑 장비의 구입에 어려움이 있다면 IDS를 설치하고자 하는 곳에 허브를 설치하는 것도 하나의 방법일 수 있다. 단 허브를 설치하면 네트워크가 느려진다.

## 스니퍼의 탐지
스니핑에 대한 대책은 그다지 많지 않다. 스니핑 공격은 스니퍼를 설치한 이후에는 네트워크에 별다른 이상 현상을 만들지 않기 때문에 사용자가 이를 인지하는 것이 어려워 능동적인 탐지를 통해서만 잡아낼 수 있다. 스니퍼에 대한 탐지는 스니퍼가 프러미스큐어스 모드에서 작동한다는 아이디어에서 시작하면 쉬울 것이다.

**Ping을 이용한 스니퍼 탐지**
대부분의 스니퍼는 일반 TCP/IP에서 동작하기 때문에 Request를 받으면 Response를 전달한다. 이를 이용해 의심이 가는 호스트에 ping을 보내면 되는데, 네트워크에 존재하지 않는 MAC 주소를 위장하여 보내는 것이다. 만약 ICMP Echo Reply를 받으면 해당 호스트가 스니핑을 하고 있는 것이다. 왜냐하면 존재하지 않는 MAC 주소를 사용했으므로 스니핑을 하지 않는 호스트는 누구도 Ping Request를 볼 수 없는 것이 정상이기 때문이다.

**ARP를 이용한 스니퍼 탐지**
ping과 유사한 방법으로, 위조된 ARP Request를 보냈을 때 ARP Response가 오면 프러미스큐어스 모드로 설정되어 있는 것이다.

**DNS를 이용한 스니퍼 탐지**
일반적으로 스니핑 프로그램은 사용자의 편의를 위해 스니핑한 시스템의 IP 주소에 DNS에 대한 이름 해석 과정을 수행한다. 이 방법은 원격과 로콜에서 모두 사용할 수 있으며, 테스트 대상 네트워크로 Ping Sweep을 보내고 들어오는 이름 해석 과정을 감시하여 스니퍼를 탐지한다.

**유인(Decoy)을 이용한 스니퍼 탐지**
스니핑 공격을 하는 공격자의 주요 목적은 ID와 패스워드의 획득에 있다. 따라서 보안 관리자는 이 점을 이용하여 가짜 ID와 패스워드를 이용하여 접속을 시도할 때 스니퍼를 탐지한다.

**ARP watch를 이용한 스니퍼 탐지**
ARP watch는 MAC 주소와 IP 주소의 매칭 값을 초기에 저장하고 ARP 트래픽을 모니터링하여, 이를 변하게 하는 패킷이 탐지되면 관리자에게 메일로 알려주는 툴이다. 대부분의 공격 기법이 위조된 ARP를 사용하기 때문에 쉽게 탐지할 수 있다.
